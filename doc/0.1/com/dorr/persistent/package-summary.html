<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc (1.8.0_40-internal) on Sun Feb 15 22:40:59 GMT 2015 -->
<title>com.dorr.persistent (Persistent 0.1 API)</title>
<meta name="date" content="2015-02-15">
<link rel="stylesheet" type="text/css" href="../../../stylesheet.css" title="Style">
<script type="text/javascript" src="../../../script.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="com.dorr.persistent (Persistent 0.1 API)";
        }
    }
    catch(err) {
    }
//-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a name="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../com/dorr/persistent/package-summary.html">Package</a></li>
<li>Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-all.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li>Prev&nbsp;Package</li>
<li>Next&nbsp;Package</li>
</ul>
<ul class="navList">
<li><a href="../../../index.html?com/dorr/persistent/package-summary.html" target="_top">Frames</a></li>
<li><a href="package-summary.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<a name="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
<div class="header">
<h1 title="Package" class="title">Package&nbsp;com.dorr.persistent</h1>
<div class="docSummary">
<div class="block">A small collection of <em>persistent</em> data structures for use in plain old Java code
 (a persistent array, hash map, hash set and linked list).</div>
</div>
<p>See:&nbsp;<a href="#package.description">Description</a></p>
</div>
<div class="contentContainer">
<ul class="blockList">
<li class="blockList">
<table class="typeSummary" border="0" cellpadding="3" cellspacing="0" summary="Interface Summary table, listing interfaces, and an explanation">
<caption><span>Interface Summary</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Interface</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor">
<td class="colFirst"><a href="../../../com/dorr/persistent/PersistentArray.html" title="interface in com.dorr.persistent">PersistentArray</a>&lt;T&gt;</td>
<td class="colLast">
<div class="block">A persistent array that does not support in-place updates,
 but supports 'copy' updates with structural sharing.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../com/dorr/persistent/PersistentList.html" title="interface in com.dorr.persistent">PersistentList</a>&lt;T&gt;</td>
<td class="colLast">
<div class="block">A persistent list that does not support in-place updates,
 but supports 'copy' updates with structural sharing.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../com/dorr/persistent/PersistentMap.html" title="interface in com.dorr.persistent">PersistentMap</a>&lt;K,V&gt;</td>
<td class="colLast">
<div class="block">A persistent map that does not support in-place updates,
 but supports 'copy' updates with structural sharing.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../com/dorr/persistent/PersistentSet.html" title="interface in com.dorr.persistent">PersistentSet</a>&lt;T&gt;</td>
<td class="colLast">
<div class="block">A persistent set that does not support in-place updates,
 but supports 'copy' updates with structural sharing.</div>
</td>
</tr>
</tbody>
</table>
</li>
<li class="blockList">
<table class="typeSummary" border="0" cellpadding="3" cellspacing="0" summary="Class Summary table, listing classes, and an explanation">
<caption><span>Class Summary</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Class</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tbody>
<tr class="altColor">
<td class="colFirst"><a href="../../../com/dorr/persistent/HashTrieMap.html" title="class in com.dorr.persistent">HashTrieMap</a>&lt;K,V&gt;</td>
<td class="colLast">
<div class="block">An implementation of the persistent hash trie map.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../com/dorr/persistent/HashTrieSet.html" title="class in com.dorr.persistent">HashTrieSet</a>&lt;T&gt;</td>
<td class="colLast">
<div class="block">An implementation of the persistent hash trie set, based on the HashTrieMap.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../com/dorr/persistent/LinkedList.html" title="class in com.dorr.persistent">LinkedList</a>&lt;T&gt;</td>
<td class="colLast">
<div class="block">A persistent singly-linked list.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><a href="../../../com/dorr/persistent/PersistentArrays.html" title="class in com.dorr.persistent">PersistentArrays</a></td>
<td class="colLast">
<div class="block">Utility methods for working with <a href="../../../com/dorr/persistent/PersistentArray.html" title="interface in com.dorr.persistent"><code>PersistentArray</code></a> values.</div>
</td>
</tr>
<tr class="altColor">
<td class="colFirst"><a href="../../../com/dorr/persistent/TrieArray.html" title="class in com.dorr.persistent">TrieArray</a>&lt;T&gt;</td>
<td class="colLast">
<div class="block">An implementation of the persistent trie array.</div>
</td>
</tr>
</tbody>
</table>
</li>
</ul>
<a name="package.description">
<!--   -->
</a>
<h2 title="Package com.dorr.persistent Description">Package com.dorr.persistent Description</h2>
<div class="block">A small collection of <em>persistent</em> data structures for use in plain old Java code
 (a persistent array, hash map, hash set and linked list).

 <p>If you're familiar with functional JVM languages such as Clojure & Scala, this is an
 implementation of some of the standard collections in those languages, if not, don't worry,
 these collections just provide a different sort of update operation - the <em>persistent
 update</em> (instead of the <em>mutatable update</em>).</p>
 <p>A <em>mutable update</em> is an operation that modifies the original collection (so if
 you <code>put</code> into a <code>HashMap</code>, the original hash map will now contain the
 new mapping). A <em>persistent update</em>, however, does not modify the original, instead
 it returns a new collection with the update applied (the original collection is never
 modified).</p>
 <p>The obvious question is 'why?', to which I shall mainly just say - try it out, and see for
 yourself. But to motivate you to try this, I'll just claim that it provides this guarantee
 (that any reference to a persistent collection I have will never be modified, never have to
 acquire a lock, and never throw a <code>ConcurrentModificationException</code>) that is very
 helpful to make programs that are simpler, more likely to be correct and more easily adapted
 to support concurrency.</p>

 <h2>Usage</h2>
 <p>Each collection implements the relevant immutable Java collection, and adds just
 a few methods needed to provide the new persistent update methods.
 A persistent update method is just a method that returns a new collection with
 some modification (don't worry, they do so without copying the whole collection.)
 For example, with a Java mutable <code>Set</code>, you might write:</p>
 <pre><code> Set&lt;String&gt; s = new HashSet&lt;&gt;();
 s.add("one");
 s.add("two");</code></pre>
 With persistent collections, you could write:
 <pre><code> PersistentSet&lt;String&gt; s = HashTrieSet.empty();
 s = s.with("one");
 s = s.with("two");</code></pre>

 <p>So if you have a reference to a <code>PersistentSet</code>, you can be sure that the
 contents of that set will never change. But you can create a new set <em>based on</em>
 the existing set efficiently, e.g. either with or without a given value.
 So it is very easy to get started with persistent collections - you just need to get used to the
 persistent update operation, and replace your mutable collections with the equivalent persistent
 ones (we provide a table below to help you get started). The way to read this is "if I would have
 used <code>java.util.X</code>, I'll start using <code>com.dorr.persistent.Y</code>" (these are only
 rough guidelines).</p>

 <table>
     <thead>
         <tr>
             <th>Mutable collection (<code>java.util.?</code>)</th>
             <th>Persistent collection (<code>com.dorr.persistent.?</code>)</th>
             <th>Fast operations</th>
         </tr>
     </thead>
     <tbody>
         <tr>
             <td><a href="http://docs.oracle.com/javase/7/docs/api/java/util/ArrayList.html?is-external=true" title="class or interface in java.util"><code>ArrayList</code></a></td>
             <td><a href="../../../com/dorr/persistent/TrieArray.html" title="class in com.dorr.persistent"><code>TrieArray</code></a></td>
             <td>random access; random update; insertion at back</td>
         </tr>
         <tr>
             <td><a href="http://docs.oracle.com/javase/7/docs/api/java/util/LinkedList.html?is-external=true" title="class or interface in java.util"><code>LinkedList</code></a></td>
             <td><a href="../../../com/dorr/persistent/LinkedList.html" title="class in com.dorr.persistent"><code>LinkedList</code></a></td>
             <td>query, insertion or removal at front</td>
         </tr>
         <tr>
             <td><a href="http://docs.oracle.com/javase/7/docs/api/java/util/HashSet.html?is-external=true" title="class or interface in java.util"><code>HashSet</code></a>, <a href="http://docs.oracle.com/javase/7/docs/api/java/util/TreeSet.html?is-external=true" title="class or interface in java.util"><code>TreeSet</code></a></td>
             <td><a href="../../../com/dorr/persistent/HashTrieSet.html" title="class in com.dorr.persistent"><code>HashTrieSet</code></a></td>
             <td>unique insert; contains</td>
         </tr>
         <tr>
             <td><a href="http://docs.oracle.com/javase/7/docs/api/java/util/HashMap.html?is-external=true" title="class or interface in java.util"><code>HashMap</code></a>, <a href="http://docs.oracle.com/javase/7/docs/api/java/util/TreeMap.html?is-external=true" title="class or interface in java.util"><code>TreeMap</code></a></td>
             <td><a href="../../../com/dorr/persistent/HashTrieMap.html" title="class in com.dorr.persistent"><code>HashTrieMap</code></a></td>
             <td>unique insert; lookup</td>
         </tr>
     </tbody>
 </table>

 <p>Once you've settled on the type of your collection, you'll need to know how to use it. Each collection
 implements the appropriate Java interface for a read-only collection (all the mutating operations throw
 a <code>UnsupportedOperationException</code>), and are replaced by equivalent persistent update operations
 as shown below.</p>
 <table>
     <thead>
         <tr>
             <th>Mutable method</th>
             <th>Persistent method</th>
         </tr>
     </thead>
     <tbody>
         <tr>
             <td><a href="http://docs.oracle.com/javase/7/docs/api/java/util/List.html?is-external=true#add-E-" title="class or interface in java.util"><code>List.add(java.lang.Object)</code></a></td>
             <td><a href="../../../com/dorr/persistent/PersistentArray.html#append-T-"><code>PersistentArray.append(java.lang.Object)</code></a></td>
         </tr>
         <tr>
             <td><a href="http://docs.oracle.com/javase/7/docs/api/java/util/List.html?is-external=true#set-int-E-" title="class or interface in java.util"><code>List.set(int, java.lang.Object)</code></a></td>
             <td><a href="../../../com/dorr/persistent/PersistentArray.html#update-int-T-"><code>PersistentArray.update(int, java.lang.Object)</code></a></td>
         </tr>
         <tr>
             <td><a href="http://docs.oracle.com/javase/7/docs/api/java/util/List.html?is-external=true#remove-int-" title="class or interface in java.util"><code>List.remove(int)</code></a></td>
             <td><a href="../../../com/dorr/persistent/PersistentArray.html#remend--"><code>PersistentArray.remend()</code></a>, <a href="../../../com/dorr/persistent/PersistentArrays.html#remove-com.dorr.persistent.PersistentArray-int-"><code>PersistentArrays.remove(com.dorr.persistent.PersistentArray, int)</code></a></td>
         </tr>
         <tr>
             <td><a href="http://docs.oracle.com/javase/7/docs/api/java/util/LinkedList.html?is-external=true#addFirst-E-" title="class or interface in java.util"><code>LinkedList.addFirst(java.lang.Object)</code></a></td>
             <td><a href="../../../com/dorr/persistent/PersistentList.html#prepend-T-"><code>PersistentList.prepend(java.lang.Object)</code></a></td>
         </tr>
         <tr>
             <td><a href="http://docs.oracle.com/javase/7/docs/api/java/util/LinkedList.html?is-external=true#getFirst--" title="class or interface in java.util"><code>LinkedList.getFirst()</code></a></td>
             <td><a href="../../../com/dorr/persistent/PersistentList.html#head--"><code>PersistentList.head()</code></a></td>
         </tr>
         <tr>
             <td><a href="http://docs.oracle.com/javase/7/docs/api/java/util/Set.html?is-external=true#add-E-" title="class or interface in java.util"><code>Set.add(java.lang.Object)</code></a></td>
             <td><a href="../../../com/dorr/persistent/PersistentSet.html#with-T-"><code>PersistentSet.with(java.lang.Object)</code></a></td>
         </tr>
         <tr>
             <td><a href="http://docs.oracle.com/javase/7/docs/api/java/util/Set.html?is-external=true#remove-java.lang.Object-" title="class or interface in java.util"><code>Set.remove(java.lang.Object)</code></a></td>
             <td><a href="../../../com/dorr/persistent/PersistentSet.html#without-T-"><code>PersistentSet.without(java.lang.Object)</code></a></td>
         </tr>
         <tr>
             <td><a href="http://docs.oracle.com/javase/7/docs/api/java/util/Map.html?is-external=true#put-K-V-" title="class or interface in java.util"><code>Map.put(java.lang.Object, java.lang.Object)</code></a></td>
             <td><a href="../../../com/dorr/persistent/PersistentMap.html#with-K-V-"><code>PersistentMap.with(java.lang.Object, java.lang.Object)</code></a></td>
         </tr>
         <tr>
             <td><a href="http://docs.oracle.com/javase/7/docs/api/java/util/Map.html?is-external=true#remove-java.lang.Object-" title="class or interface in java.util"><code>Map.remove(java.lang.Object)</code></a></td>
             <td><a href="../../../com/dorr/persistent/PersistentMap.html#without-K-"><code>PersistentMap.without(java.lang.Object)</code></a></td>
         </tr>
     </tbody>
 </table>

 <h2>When should I use them?</h2>
 <p>I think these collections are great - but I don't recommend using them all the time. The main benefit is that they
 provide a strong guarantee - if I have a reference to a persistent collection, it will never be modified, and it will
 never have to acquire a lock when I use it. This guarantee comes at the cost of slightly more work when using
 and updating the collection, and more small memory allocations. While JVM implementations are typically very good
 at handling small object allocations, this does result in a performance penalty for using persistent collections.
 For example, in one of my tests, the persistent hash trie map with 10000 elements was just 10% slower for access,
 and 2.5-3x slower for insertions. Please don't let this penalty put you off using them altogether - it sounds a lot,
 but if the bulk of your runtime isn't spent updating collections, using persistent collections probably won't make
 your program slower. I would suggest that if you can make a concurrent Android app using persistent collections, your
 users will often feel better performance than they would with a 'faster' Android app using mutable collections (where
 the concurrency is limited by the difficulties of correctly synchronizing data access).</p>

 <p>Because of this tradeoff of safety against performance, I would generally use a mutable collection where the
 scope of the collection is very limited & simple (e.g. within a single method). When the scope of the collection is
 large or complex (e.g. returned by an interface method), I would prefer the no-modification guarantee of a persistent
 collection.</p>
 <ul>
 <li>For example, I am writing an algorithm that requires a stack to run, but once finished the stack is garbage. I have
 the choice between the mutable <a href="http://docs.oracle.com/javase/7/docs/api/java/util/ArrayDeque.html?is-external=true" title="class or interface in java.util"><code>ArrayDeque</code></a> and the persistent <a href="../../../com/dorr/persistent/TrieArray.html" title="class in com.dorr.persistent"><code>TrieArray</code></a>.
 In this case, I would choose the mutable <a href="http://docs.oracle.com/javase/7/docs/api/java/util/ArrayDeque.html?is-external=true" title="class or interface in java.util"><code>ArrayDeque</code></a>, as it has higher performance, and the
 no-modification guarantee doesn't really make my program any simpler or safer.</li>

 <li>Now I am writing an <code>Event</code> type for a UI framework and must provide within the payload a set of objects.
 Again, I can choose between a mutable <a href="http://docs.oracle.com/javase/7/docs/api/java/util/HashSet.html?is-external=true" title="class or interface in java.util"><code>HashSet</code></a> and a persistent <a href="../../../com/dorr/persistent/HashTrieSet.html" title="class in com.dorr.persistent"><code>HashTrieSet</code></a>.
 This time, the scope of the collection is potentially large, and certainly complex (it can change at runtime as event
 handlers are added), so I would prefer the persistent <a href="../../../com/dorr/persistent/HashTrieSet.html" title="class in com.dorr.persistent"><code>HashTrieSet</code></a>.</li>
 </ul>
 <p>Often your decisions won't be as extreme as this - but as you gain confidence in using persistent collections, I
 would suggest that most collections that are exposed by a method or field on a class or interface should provide
 the no-modification guarantee.</p>

 <h2>Collection extensions</h2>
 <p>Each concrete collection type conforms to the Java collection model, namely extends from a <code>Collection</code>
 interface (<code>List/Set/Map</code>), provides a zero-argument constructor, and a single-argument <code>Collection</code>
 constructor. All destructive mutation operations throw <code>UnsupportedOperationException</code>. All collections support
 Java's built-in serialization framework.</p>

 <p>In addition, we provide a few extensions to Java collections, to make creation easy, in particular a value <code>EMPTY</code>,
 which is always the empty map/list/set, a convenience function <code>empty()</code> (which can be used to hide unchecked
 conversion errors), and factory methods <code>singleton()</code> to create a single-element collection and <code>of(...)</code>
 which creates a collection from a flat array.</p></div>
</div>
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a name="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a name="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../com/dorr/persistent/package-summary.html">Package</a></li>
<li>Class</li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../index-all.html">Index</a></li>
<li><a href="../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList">
<li>Prev&nbsp;Package</li>
<li>Next&nbsp;Package</li>
</ul>
<ul class="navList">
<li><a href="../../../index.html?com/dorr/persistent/package-summary.html" target="_top">Frames</a></li>
<li><a href="package-summary.html" target="_top">No&nbsp;Frames</a></li>
</ul>
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../allclasses-noframe.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
</div>
<a name="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</body>
</html>
